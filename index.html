<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anadolu Gençlik Derneği - Tablo Editörü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background-image: url('img/bg_agd.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            position: fixed;
            top: 0;
            left: 20px;
            right: 20px;
            width: auto;
            margin-left: auto;
            margin-right: auto;
            max-width: 1600px;
            z-index: 101;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .toolbar {
            background: rgba(255, 255, 255, 0.95);
            position: fixed;
            left: 20px;
            right: 20px;
            width: auto;
            margin-left: auto;
            margin-right: auto;
            max-width: 1600px;
            z-index: 100;
            padding: 20px 30px;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .btn-warning:hover {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .btn-info {
            background: linear-gradient(45deg, #5dade2, #2e86c1);
            box-shadow: 0 4px 12px rgba(93, 173, 226, 0.3);
        }

        .btn-info:hover {
            box-shadow: 0 6px 20px rgba(93, 173, 226, 0.4);
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .table-container {
            padding: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        th,
        td {
            padding: 12px;
            border: 2px solid #dee2e6;
            text-align: left;
            vertical-align: middle;
            position: relative;
        }

        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
           background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        td:hover {
            background: #f8f9fa;
        }

        /* Checkbox sütunu için özel stil */
        th.row-checkbox-cell,
        td.row-checkbox-cell {
            width: 40px !important;
            /* Sabit genişlik */
            min-width: 40px !important;
            text-align: center !important;
            padding: 8px !important;
            /* Daha az padding */
        }

        td.row-checkbox-cell input[type="checkbox"] {
            cursor: pointer;
            /* Dikey hizalama için gerekirse */
            /* vertical-align: middle; */
        }

        .editable {
            border: none;
            background: transparent;
            width: 100%;
            padding: 8px;
            font-size: inherit;
            font-family: inherit;
            color: inherit;
        }

        .editable:focus {
            outline: 2px solid #3498db;
            background: #fff;
            border-radius: 4px;
        }

        .selected-row {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }

        .selected-row td {
            background: #fff3cd !important;
            border: 2px solid #ffc107 !important;
        }

        .selected-column {
            background: #e3f2fd !important;
            border: 2px solid #2196f3 !important;
        }

        /* Tekil hücre seçimi için stil */
        .selected-cell {
            background: #d4edda !important;
            border: 3px solid #28a745 !important;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
        }

        .color-palette {
            display: none;
            position: fixed;
            top: 20px !important;
            left: 20px !important;
            z-index: 2000;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-width: 350px;
        }

        .color-palette.show {
            display: grid;
        }

        .color-item {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .color-item:hover {
            transform: scale(1.2);
            border: 2px solid #333;
        }

        .selection-info {
            background: #e3f2fd;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            font-size: 14px;
            color: #1976d2;
            display: none;
        }

        .selection-info.show {
            display: block;
        }

        .row-actions,
        .col-actions {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px;
            border-radius: 6px;
            z-index: 1000;
            display: none;
        }

        .row-actions button,
        .col-actions button {
            background: #fff;
            border: none;
            padding: 6px 10px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .stats {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #e74c3c;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 0;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-group {
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Anadolu Gençlik Derneği</h1>
            <p>Dinamik Tablo Editörü ve Excel Export Sistemi</p>
        </div>
        <div class="toolbar">
            <div class="btn-group">
                <button class="btn btn-success" id="addRowBtn" onclick="addRow()">➕ Satır Ekle</button>
                <button class="btn btn-success" id="addColumnBtn" onclick="addColumn()">➕ Sütun Ekle</button>
                <button class="btn btn-danger" id="singleDeleteRowBtn" onclick="deleteSelectedRow()">🗑️ Tek Satır
                    Sil</button>
                <button class="btn btn-info" id="toggleMultiDeleteBtn" onclick="toggleMultiDeleteMode()">🔪 Çoklu
                    Silme</button>
                <button class="btn btn-success" id="confirmDeleteSelectedBtn" onclick="confirmDeleteSelectedRows()"
                    style="display:none;">✔️ Seçilenleri Sil</button>
                <button class="btn btn-danger" id="deleteColumnBtn" onclick="deleteSelectedColumn()">🗑️ Sütun
                    Sil</button>
            </div>


            <div class="btn-group">
                <button class="btn btn-warning" onclick="showColorPalette('bg')">🎨 Arka Plan</button>
                <button class="btn btn-warning" onclick="showColorPalette('text')">✏️ Yazı Rengi</button>
                <button class="btn btn-danger" onclick="clearCellFormat()">🗑️ Renk Temizle</button>
                <button class="btn" onclick="clearSelection()">❌ Seçimi Kaldır</button>
            </div>


            <div class="btn-group">
                <button class="btn" onclick="exportToExcelBasic()">📊 Basit Excel</button>
                <button class="btn btn-success" onclick="exportToExcelAdvanced()">🎨 Formatlı Excel</button>
                <button class="btn" onclick="exportToCSV()">📄 CSV İndir</button>
                <button class="btn" onclick="window.print()">🖨️ Yazdır</button>
            </div>


            <div class="btn-group">
                <button class="btn btn-warning" onclick="saveTable()">💾 Kaydet</button>
                <button class="btn btn-warning" onclick="loadTable()">📂 Yükle</button>
                <button class="btn btn-danger" onclick="clearTable()">🗑️ Temizle</button>
                <button class="btn" onclick="converter()"> 📄 JSON Dönüştür</button>
            </div>

            <div class="selection-info" id="selectionInfo">
                <span id="selectionText">Seçim yapılmadı</span>
            </div>
        </div>

        <div class="table-container">
            <table id="dynamicTable">
                <thead>
                    <tr>
                        <th onclick="selectColumn(0)" style="background: #2c3e50; color: white;">ID</th>
                        <th onclick="selectColumn(1)" style="background: #2c3e50; color: white;">Ad Soyad</th>
                        <th onclick="selectColumn(2)" style="background: #2c3e50; color: white;">Mevki</th>
                        <th onclick="selectColumn(3)" style="background: #2c3e50; color: white;">Departman</th>
                        <th onclick="selectColumn(4)" style="background: #2c3e50; color: white;">Telefon</th>
                    </tr>
                </thead>
                <tbody>
                    <tr onclick="selectRow(this)" style="cursor: pointer;">
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="1" readonly></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Ahmet YILMAZ"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Başkan"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Yönetim"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="0532 123 45 67"></td>
                    </tr>
                    <tr onclick="selectRow(this)" style="cursor: pointer;">
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="2" readonly></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Elif KAYA"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Sekreter"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Yönetim"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="0533 234 56 78"></td>
                    </tr>
                    <tr onclick="selectRow(this)" style="cursor: pointer;">
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="3" readonly></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Mehmet ALİ"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Üye"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="Etkinlik"></td>
                        <td onclick="selectCell(this, event)" style="cursor: pointer;"><input type="text"
                                class="editable" value="0534 345 67 89"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="rowCount">3</div>
                <div class="stat-label">Toplam Satır</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="columnCount">5</div>
                <div class="stat-label">Toplam Sütun</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="cellCount">15</div>
                <div class="stat-label">Toplam Hücre</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2025</div>
                <div class="stat-label">Versiyon</div>
            </div>
        </div>
    </div>

    <div id="colorPalette" class="color-palette">
        <div class="color-item" style="background: #ffffff" onclick="applyColor('#ffffff')" title="Beyaz"></div>
        <div class="color-item" style="background: #f8f9fa" onclick="applyColor('#f8f9fa')" title="Açık Gri"></div>
        <div class="color-item" style="background: #e9ecef" onclick="applyColor('#e9ecef')" title="Gri"></div>
        <div class="color-item" style="background: #dee2e6" onclick="applyColor('#dee2e6')" title="Koyu Gri"></div>
        <div class="color-item" style="background: #6c757d" onclick="applyColor('#6c757d')" title="Daha Koyu Gri"></div>
        <div class="color-item" style="background: #495057" onclick="applyColor('#495057')" title="Çok Koyu Gri"></div>
        <div class="color-item" style="background: #343a40" onclick="applyColor('#343a40')" title="Siyaha Yakın"></div>
        <div class="color-item" style="background: #000000" onclick="applyColor('#000000')" title="Siyah"></div>

        <div class="color-item" style="background: #fff3cd" onclick="applyColor('#fff3cd')" title="Açık Sarı"></div>
        <div class="color-item" style="background: #ffeaa7" onclick="applyColor('#ffeaa7')" title="Sarı"></div>
        <div class="color-item" style="background: #fdcb6e" onclick="applyColor('#fdcb6e')" title="Turuncu"></div>
        <div class="color-item" style="background: #e17055" onclick="applyColor('#e17055')" title="Kırmızı-Turuncu">
        </div>
        <div class="color-item" style="background: #d63031" onclick="applyColor('#d63031')" title="Kırmızı"></div>
        <div class="color-item" style="background: #a29bfe" onclick="applyColor('#a29bfe')" title="Açık Mor"></div>
        <div class="color-item" style="background: #6c5ce7" onclick="applyColor('#6c5ce7')" title="Mor"></div>
        <div class="color-item" style="background: #fd79a8" onclick="applyColor('#fd79a8')" title="Pembe"></div>

        <div class="color-item" style="background: #d1f2eb" onclick="applyColor('#d1f2eb')" title="Açık Yeşil"></div>
        <div class="color-item" style="background: #55efc4" onclick="applyColor('#55efc4')" title="Mint Yeşil"></div>
        <div class="color-item" style="background: #00b894" onclick="applyColor('#00b894')" title="Yeşil"></div>
        <div class="color-item" style="background: #00a085" onclick="applyColor('#00a085')" title="Koyu Yeşil"></div>
        <div class="color-item" style="background: #74b9ff" onclick="applyColor('#74b9ff')" title="Açık Mavi"></div>
        <div class="color-item" style="background: #0984e3" onclick="applyColor('#0984e3')" title="Mavi"></div>
        <div class="color-item" style="background: #2d3436" onclick="applyColor('#2d3436')" title="Metal"></div>
        <div class="color-item" style="background: #636e72" onclick="applyColor('#636e72')" title="Gri-Mavi"></div>

        <div class="color-item" style="background: #ffeaa7" onclick="applyColor('#ffeaa7')" title="Açık Sarı 2"></div>
        <div class="color-item" style="background: #fab1a0" onclick="applyColor('#fab1a0')" title="Şeftali"></div>
        <div class="color-item" style="background: #ff7675" onclick="applyColor('#ff7675')" title="Açık Kırmızı"></div>
        <div class="color-item" style="background: #2c3e50" onclick="applyColor('#2c3e50')" title="Koyu Mavi"></div>
        <div class="color-item" style="background: #fdcb6e" onclick="applyColor('#fdcb6e')" title="Altın Sarısı"></div>
        <div class="color-item" style="background: #e84393" onclick="applyColor('#e84393')" title="Magenta"></div>
        <div class="color-item" style="background: #00cec9" onclick="applyColor('#00cec9')" title="Turkuaz"></div>
        <div class="color-item" style="background: #81ecec" onclick="applyColor('#81ecec')" title="Açık Turkuaz"></div>
    </div>

    <div id="columnModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('columnModal')">&times;</span>
            <h3>Yeni Sütun Ekle</h3>
            <div class="form-group">
                <label>Sütun Adı:</label>
                <input type="text" id="columnName" placeholder="Sütun adını girin">
            </div>
            <div class="form-group">
                <label>Konum:</label>
                <select id="columnPosition">
                    <option value="end">Sona Ekle</option>
                    <option value="start">Başa Ekle</option>
                </select>
            </div>
            <button class="btn btn-success" onclick="confirmAddColumn()">Ekle</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

    <script>
        let selectedCell = null;
        let selectedRow = null;
        let selectedColumn = null;
        let colorTargetType = '';
        let isMultiDeleteModeActive = false;
        const CHECKBOX_COLUMN_CLASS = 'row-checkbox-cell';


        function converter()
        {
            window.location.href = 'converter.html';
        }

        function updateFixedElementLayout() {
            const headerElement = document.querySelector('.header');
            const toolbarElement = document.querySelector('.toolbar');
            const containerElement = document.querySelector('.container');

            if (headerElement && toolbarElement && containerElement) {
                const headerHeight = headerElement.offsetHeight;
                toolbarElement.style.top = headerHeight + 'px';

                const toolbarHeight = toolbarElement.offsetHeight;

                containerElement.style.paddingTop = (headerHeight + toolbarHeight) + 'px';
            }
        }

        function updateSelectionInfo(message) {
            const selectionInfoEl = document.getElementById('selectionInfo');
            const selectionTextEl = document.getElementById('selectionText');
            if (message) {
                selectionTextEl.textContent = message;
                selectionInfoEl.classList.add('show');
            } else {
                selectionTextEl.textContent = 'Seçim yapılmadı';
                selectionInfoEl.classList.remove('show');
            }
        }

        function selectCell(cell, event) {
            if (event) {
                event.stopPropagation();
            }
            if (isMultiDeleteModeActive) {
                if (cell.parentNode.tagName === 'TR') {
                    selectRow(cell.parentNode);
                }
                return;
            }

            clearSelection(false);

            selectedCell = cell;
            cell.classList.add('selected-cell');

            const rowIndex = cell.parentNode.rowIndex;
            const visualCellIndex = cell.cellIndex;

            let dataCellIndex = 0;
            let counter = 0;
            const headerCells = document.getElementById('dynamicTable').rows[0].cells;
            for (let i = 0; i < headerCells.length; i++) {
                if (headerCells[i].classList.contains(CHECKBOX_COLUMN_CLASS)) {
                    if (i < visualCellIndex) counter++;
                } else {
                    if (i === visualCellIndex) break;
                }
            }
            dataCellIndex = visualCellIndex - counter;

            const headerText = headerCells[visualCellIndex]?.textContent || (dataCellIndex + 1);
            updateSelectionInfo(`Hücre seçildi: Satır ${cell.parentNode.parentNode.tagName === 'TBODY' ? Array.from(cell.parentNode.parentNode.children).indexOf(cell.parentNode) + 1 : 'Başlık'}, Sütun "${headerText}"`);

            if (event && (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA')) {
                return;
            }
        }

        function selectRow(row) {
            if (isMultiDeleteModeActive) {
                const checkboxCell = row.cells[0];
                if (checkboxCell && checkboxCell.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                    const checkbox = checkboxCell.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                    }
                }
                return;
            }
            clearSelection(false);
            selectedRow = row;
            row.classList.add('selected-row');
            const rowIndex = Array.from(row.parentNode.children).indexOf(row) + 1;
            updateSelectionInfo(`Satır ${rowIndex} seçildi.`);
        }

        function selectColumn(index) {
            const headerCell = document.getElementById('dynamicTable').querySelector('thead tr').cells[index];
            if (isMultiDeleteModeActive || (headerCell && headerCell.classList.contains(CHECKBOX_COLUMN_CLASS))) {
                return;
            }
            clearSelection(false);

            selectedColumn = index;
            const table = document.getElementById('dynamicTable');
            const rows = table.querySelectorAll('tr');
            let headerText = "";

            rows.forEach(rowNode => {
                const cell = rowNode.cells[index];
                if (cell) {
                    cell.classList.add('selected-column');
                    if (rowNode.parentNode.tagName === 'THEAD') {
                        headerText = cell.textContent;
                    }
                }
            });
            updateSelectionInfo(`Sütun "${headerText || index + 1}" seçildi.`);
        }

        function showColorPalette(target) {
            colorTargetType = target;
            const palette = document.getElementById('colorPalette');
            palette.classList.add('show');

            palette.style.top = '20px';
            palette.style.left = '20px';

            setTimeout(() => {
                document.addEventListener('click', hidePaletteOnClickOutside, { once: true });
            }, 0);
        }

        function hidePaletteOnClickOutside(event) {
            const palette = document.getElementById('colorPalette');
            if (!palette.contains(event.target) && !event.target.closest('[onclick^="showColorPalette"]')) {
                palette.classList.remove('show');
            } else {
                document.addEventListener('click', hidePaletteOnClickOutside, { once: true });
            }
        }

        function applyColor(color) {
            const palette = document.getElementById('colorPalette');

            if (selectedCell) {
                if (colorTargetType === 'bg') {
                    selectedCell.style.backgroundColor = color;
                } else if (colorTargetType === 'text') {
                    selectedCell.style.color = color;
                    const input = selectedCell.querySelector('.editable');
                    if (input) input.style.color = color;
                }
            } else if (selectedRow) {
                Array.from(selectedRow.cells).forEach(cell => {
                    if (cell.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    if (colorTargetType === 'bg') {
                        cell.style.backgroundColor = color;
                    } else if (colorTargetType === 'text') {
                        cell.style.color = color;
                        const input = cell.querySelector('.editable');
                        if (input) input.style.color = color;
                    }
                });
            } else if (selectedColumn !== null) {
                const table = document.getElementById('dynamicTable');
                table.querySelectorAll('tr').forEach(row => {
                    const cell = row.cells[selectedColumn];
                    if (cell && !cell.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                        if (colorTargetType === 'bg') {
                            cell.style.backgroundColor = color;
                        } else if (colorTargetType === 'text') {
                            cell.style.color = color;
                            const input = cell.querySelector('.editable');
                            if (input) input.style.color = color;
                        }
                    }
                });
            } else {
                alert('Lütfen önce bir hücre, satır veya sütun seçin.');
            }
            palette.classList.remove('show');
        }

        function clearCellFormat() {
            if (selectedCell) {
                selectedCell.style.backgroundColor = '';
                selectedCell.style.color = '';
                const input = selectedCell.querySelector('.editable');
                if (input) {
                    input.style.color = '';
                }
            } else if (selectedRow) {
                Array.from(selectedRow.cells).forEach(cell => {
                    if (cell.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    cell.style.backgroundColor = '';
                    cell.style.color = '';
                    const input = cell.querySelector('.editable');
                    if (input) input.style.color = '';
                });
            } else if (selectedColumn !== null) {
                const table = document.getElementById('dynamicTable');
                table.querySelectorAll('tr').forEach(row => {
                    const cell = row.cells[selectedColumn];
                    if (cell && !cell.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                        cell.style.backgroundColor = '';
                        cell.style.color = '';
                        const input = cell.querySelector('.editable');
                        if (input) input.style.color = '';
                    }
                });
            } else {
                alert('Lütfen önce formatını temizlemek istediğiniz bir hücre, satır veya sütun seçin.');
            }
        }

        function clearSelection(updateInfo = true) {
            if (selectedCell) {
                selectedCell.classList.remove('selected-cell');
                selectedCell = null;
            }
            if (selectedRow) {
                selectedRow.classList.remove('selected-row');
                selectedRow = null;
            }
            if (selectedColumn !== null) {
                const table = document.getElementById('dynamicTable');
                table.querySelectorAll('tr').forEach(row => {
                    const cell = row.cells[selectedColumn];
                    if (cell) {
                        cell.classList.remove('selected-column');
                    }
                });
                selectedColumn = null;
            }
            if (updateInfo && !isMultiDeleteModeActive) {
                updateSelectionInfo(null);
            } else if (updateInfo && isMultiDeleteModeActive) {
                updateSelectionInfo('Çoklu satır silme modu aktif. Silmek istediğiniz satırları seçin ve onaylayın.');
            }
        }

        function addRow() {
            const table = document.getElementById('dynamicTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            const newRow = tbody.insertRow();
            const headerRow = table.querySelector('thead tr');

            let dataColumnCount = 0;
            if (headerRow) {
                Array.from(headerRow.cells).forEach(th => {
                    if (!th.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                        dataColumnCount++;
                    }
                });
            } else {
                dataColumnCount = 5;
            }


            if (isMultiDeleteModeActive) {
                const cbCell = newRow.insertCell(0);
                cbCell.classList.add(CHECKBOX_COLUMN_CLASS);
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.style.cursor = 'pointer';
                checkbox.onclick = function (event) { event.stopPropagation(); };
                cbCell.appendChild(checkbox);
                cbCell.style.textAlign = 'center';
                cbCell.style.verticalAlign = 'middle';
                cbCell.onclick = function (event) { event.stopPropagation(); checkbox.click(); };
            }

            for (let i = 0; i < dataColumnCount; i++) {
                const cell = newRow.insertCell();
                cell.onclick = function (event) { selectCell(this, event); };
                cell.style.cursor = 'pointer';

                let cellValue = "";
                let actualDataHeaderCell = null;
                let currentDataColIdx = 0;
                if (headerRow) {
                    Array.from(headerRow.cells).forEach(th => {
                        if (!th.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                            if (currentDataColIdx === i) {
                                actualDataHeaderCell = th;
                            }
                            currentDataColIdx++;
                        }
                    });
                }

                if (i === 0 && actualDataHeaderCell && (actualDataHeaderCell.textContent.toLowerCase().includes('id') || actualDataHeaderCell.textContent.toLowerCase().includes('sıra no'))) {
                    cellValue = (tbody.rows.length).toString().padStart(3, '0');
                    cell.innerHTML = `<input type="text" class="editable" value="${cellValue}" readonly>`;
                } else {
                    cell.innerHTML = `<input type="text" class="editable" value="">`;
                }
            }

            newRow.onclick = function () { selectRow(this); };
            updateStats();
            updateRowNumbers();
        }


        function addColumn() {
            document.getElementById('columnModal').style.display = 'block';
        }

        function confirmAddColumn() {
            const columnName = document.getElementById('columnName').value || 'Yeni Sütun';
            const position = document.getElementById('columnPosition').value;
            const table = document.getElementById('dynamicTable');

            const headerRow = table.querySelector('thead tr');
            const newHeader = document.createElement('th');
            newHeader.textContent = columnName;
            newHeader.style.background = '#2c3e50';
            newHeader.style.color = 'white';

            const bodyRows = table.querySelectorAll('tbody tr');

            let insertAtIndex;
            if (position === 'start') {
                insertAtIndex = headerRow.cells[0]?.classList.contains(CHECKBOX_COLUMN_CLASS) ? 1 : 0;
            } else {
                insertAtIndex = headerRow.cells.length;
            }

            headerRow.insertBefore(newHeader, headerRow.cells[insertAtIndex] || null);
            bodyRows.forEach(row => {
                const newCell = row.insertCell(insertAtIndex);
                newCell.onclick = function (event) { selectCell(this, event); };
                newCell.style.cursor = 'pointer';
                newCell.innerHTML = `<input type="text" class="editable" value="">`;
            });

            closeModal('columnModal');
            updateStats();
            updateColumnClickEvents();
        }


        function deleteSelectedRow() {
            if (selectedRow && selectedRow.parentNode && selectedRow.parentNode.tagName === 'TBODY') {
                selectedRow.remove();
                selectedRow = null;
                updateStats();
                updateRowNumbers();
                clearSelection();
            } else {
                alert('Lütfen silmek istediğiniz satırı seçin.');
            }
        }

        function deleteSelectedColumn() {
            if (selectedColumn === null) {
                alert('Lütfen silmek istediğiniz sütunu seçin.');
                return;
            }
            const table = document.getElementById('dynamicTable');
            const headerCellToDelete = table.querySelector('thead tr').cells[selectedColumn];

            if (headerCellToDelete && headerCellToDelete.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                alert('Kontrol kutusu sütunu bu şekilde silinemez.');
                return;
            }
            let isFirstDataColumnId = false;
            if (headerCellToDelete) {
                let dataColIndex = 0;
                let visualIndexCounter = 0;
                Array.from(table.querySelector('thead tr').cells).forEach((th, vIdx) => {
                    if (!th.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                        if (vIdx === selectedColumn) {
                            if (dataColIndex === 0 && (th.textContent.toLowerCase().includes('id') || th.textContent.toLowerCase().includes('sıra no'))) {
                                isFirstDataColumnId = true;
                            }
                        }
                        dataColIndex++;
                    }
                });
            }
            if (isFirstDataColumnId) {
                if (!confirm('"ID/Sıra No" sütununu silmek üzeresiniz. Bu işlem verilerinizin sıralamasını etkileyebilir ve önerilmez. Devam etmek istiyor musunuz?')) {
                    return;
                }
            }


            const rows = table.querySelectorAll('tr');
            rows.forEach(row => {
                if (row.cells[selectedColumn]) {
                    row.deleteCell(selectedColumn);
                }
            });

            selectedColumn = null;
            updateStats();
            updateColumnClickEvents();
            clearSelection();
            updateRowNumbers();
        }

        function updateColumnClickEvents() {
            const headers = document.querySelectorAll('#dynamicTable thead th');
            headers.forEach((header, index) => {
                const newHeader = header.cloneNode(true);
                header.parentNode.replaceChild(newHeader, header);
                if (!newHeader.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                    newHeader.onclick = function () { selectColumn(index); };
                    newHeader.style.cursor = 'pointer';
                } else {
                    newHeader.style.cursor = 'default';
                }
            });
        }

        function updateRowNumbers() {
            const table = document.getElementById('dynamicTable');
            const headerRow = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            if (!headerRow || !tbody || headerRow.cells.length === 0) return;

            let idColumnVisualIndex = -1;
            let dataColumnCounter = 0;

            Array.from(headerRow.cells).forEach((th, visualIndex) => {
                if (!th.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                    if (dataColumnCounter === 0) {
                        if (th.textContent.toLowerCase().includes('id') || th.textContent.toLowerCase().includes('sıra no')) {
                            idColumnVisualIndex = visualIndex;
                        }
                    }
                    dataColumnCounter++;
                }
            });

            if (idColumnVisualIndex !== -1) {
                const bodyRows = tbody.querySelectorAll('tr');
                bodyRows.forEach((row, rowIndex) => {
                    const idCell = row.cells[idColumnVisualIndex];
                    if (idCell) {
                        const input = idCell.querySelector('.editable');
                        if (input && input.hasAttribute('readonly')) {
                            const newRowNumber = (rowIndex + 1).toString().padStart(1, '0');
                            input.value = newRowNumber;
                        }
                    }
                });
            }
        }

        function updateStats() {
            const table = document.getElementById('dynamicTable');
            const rowCount = table.querySelectorAll('tbody tr').length;
            const headerRow = table.querySelector('thead tr');
            let columnCount = 0;
            if (headerRow) {
                Array.from(headerRow.cells).forEach(th => {
                    if (!th.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                        columnCount++;
                    }
                });
            }
            const cellCount = rowCount * columnCount;

            document.getElementById('rowCount').textContent = rowCount;
            document.getElementById('columnCount').textContent = columnCount;
            document.getElementById('cellCount').textContent = cellCount;
        }


        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            const columnNameInput = document.getElementById('columnName');
            if (columnNameInput) columnNameInput.value = '';
        }

        window.onclick = function (event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        function saveTable() {
            const table = document.getElementById('dynamicTable');
            const data = {
                headers: [],
                rows: [],
            };

            const headers = table.querySelectorAll('thead th');
            headers.forEach(header => {
                if (header.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                data.headers.push({
                    text: header.textContent,
                    style: {
                        backgroundColor: header.style.backgroundColor,
                        color: header.style.color
                    }
                });
            });

            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const rowData = [];
                Array.from(row.cells).forEach(cell => {
                    if (cell.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    const input = cell.querySelector('.editable');
                    rowData.push({
                        text: input ? input.value : cell.textContent,
                        style: {
                            backgroundColor: cell.style.backgroundColor,
                            color: cell.style.color,
                            isReadonly: input ? input.readOnly : false
                        }
                    });
                });
                if (rowData.length > 0) {
                    data.rows.push(rowData);
                }
            });

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `anadolu_genclik_tablo_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadTable() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (isMultiDeleteModeActive) {
                                toggleMultiDeleteMode();
                            }
                            loadTableFromData(data);
                        } catch (error) {
                            alert('Dosya yüklenirken hata oluştu: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function loadTableFromData(data) {
            const table = document.getElementById('dynamicTable');
            const theadTr = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            theadTr.innerHTML = '';
            tbody.innerHTML = '';
            clearSelection();

            data.headers.forEach((headerData, index) => {
                const th = document.createElement('th');
                th.textContent = headerData.text;
                th.style.backgroundColor = headerData.style.backgroundColor || '#2c3e50';
                th.style.color = headerData.style.color || 'white';
                theadTr.appendChild(th);
            });

            data.rows.forEach(rowData => {
                const tr = tbody.insertRow();
                tr.onclick = function () { selectRow(this); };
                tr.style.cursor = 'pointer';

                rowData.forEach(cellData => {
                    const td = tr.insertCell();
                    td.onclick = function (event) { selectCell(this, event); };
                    td.style.cursor = 'pointer';
                    td.innerHTML = `<input type="text" class="editable" value="${cellData.text || ''}" ${cellData.isReadonly ? 'readonly' : ''}>`;
                    td.style.backgroundColor = cellData.style.backgroundColor || '';
                    td.style.color = cellData.style.color || '';

                    const input = td.querySelector('.editable');
                    if (input && cellData.style.color) {
                        input.style.color = cellData.style.color;
                    }
                });
            });

            updateStats();
            updateColumnClickEvents();
            updateRowNumbers();
        }

        function clearTable() {
            if (confirm('Tüm tabloyu temizlemek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                const table = document.getElementById('dynamicTable');
                const tbody = table.querySelector('tbody');
                tbody.innerHTML = '';

                const theadTr = table.querySelector('thead tr');
                theadTr.innerHTML = `
                <th onclick="selectColumn(0)" style="background: #2c3e50; color: white; cursor: pointer;">ID</th>
            `;

                if (isMultiDeleteModeActive) {
                    toggleMultiDeleteMode();
                }

                updateStats();
                clearSelection();
                updateColumnClickEvents();
            }
        }

        function exportToExcelBasic() {
            const wasMultiDeleteActive = isMultiDeleteModeActive;
            if (wasMultiDeleteActive) hideRowCheckboxes();

            const table = document.getElementById('dynamicTable');
            const wb = XLSX.utils.book_new();
            const data = [];

            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                if (th.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                headers.push(th.textContent.trim());
            });
            data.push(headers);

            table.querySelectorAll('tbody tr').forEach(row => {
                const rowData = [];
                Array.from(row.cells).forEach(td => {
                    if (td.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    const input = td.querySelector('.editable');
                    rowData.push(input ? input.value.trim() : td.textContent.trim());
                });
                if (rowData.length > 0) data.push(rowData);
            });

            const ws = XLSX.utils.aoa_to_sheet(data);
            if (headers.length > 0) {
                ws['!cols'] = headers.map(() => ({ wch: 20 }));
            }
            XLSX.utils.book_append_sheet(wb, ws, "Anadolu Gençlik Tablosu");
            XLSX.writeFile(wb, `Anadolu_Genclik_Basit_${new Date().toISOString().slice(0, 10)}.xlsx`);

            if (wasMultiDeleteActive) showRowCheckboxes();
        }

        async function exportToExcelAdvanced() {
            const wasMultiDeleteActive = isMultiDeleteModeActive;
            if (wasMultiDeleteActive) hideRowCheckboxes();

            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet('Anadolu Gençlik Tablosu');
            const table = document.getElementById('dynamicTable');

            const headers = [];
            const headerStyles = [];
            table.querySelectorAll('thead th').forEach(th => {
                if (th.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                headers.push(th.textContent.trim());
                headerStyles.push({ bg: th.style.backgroundColor || '#2c3e50', text: th.style.color || '#ffffff' });
            });

            if (headers.length === 0) {
                alert("Dışa aktarılacak veri bulunamadı.");
                if (wasMultiDeleteActive) showRowCheckboxes();
                return;
            }

            const headerRow = worksheet.addRow(headers);
            headerRow.eachCell((cell, colNumber) => {
                const style = headerStyles[colNumber - 1];
                cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: colorToARGB(style.bg) } };
                cell.font = { name: 'Calibri', size: 12, bold: true, color: { argb: colorToARGB(style.text) } };
                cell.alignment = { horizontal: 'center', vertical: 'middle' };
                cell.border = {
                    top: { style: 'medium', color: { argb: 'FF000000' } }, left: { style: 'medium', color: { argb: 'FF000000' } },
                    bottom: { style: 'medium', color: { argb: 'FF000000' } }, right: { style: 'medium', color: { argb: 'FF000000' } }
                };
            });
            worksheet.columns = headers.map(() => ({ width: 25 }));

            table.querySelectorAll('tbody tr').forEach(trNode => {
                const rowData = [];
                const cellStyles = [];
                Array.from(trNode.cells).forEach(td => {
                    if (td.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    const input = td.querySelector('.editable');
                    rowData.push(input ? input.value.trim() : td.textContent.trim());
                    cellStyles.push({ bg: td.style.backgroundColor || '#ffffff', text: td.style.color || '#000000' });
                });

                if (rowData.length > 0) {
                    const dataRow = worksheet.addRow(rowData);
                    dataRow.eachCell((cell, colNumber) => {
                        const style = cellStyles[colNumber - 1];
                        cell.font = { name: 'Calibri', size: 11, color: { argb: colorToARGB(style.text) } };
                        if (style.bg && style.bg !== 'rgb(255, 255, 255)' && style.bg !== '#ffffff' && style.bg !== 'transparent' && style.bg !== '') {
                            cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: colorToARGB(style.bg) } };
                        }
                        cell.alignment = { vertical: 'middle', wrapText: true };
                        cell.border = { /* ... (sınır stilleri aynı kalabilir) ... */
                            top: { style: 'thin', color: { argb: 'FFBFBFBF' } }, left: { style: 'thin', color: { argb: 'FFBFBFBF' } },
                            bottom: { style: 'thin', color: { argb: 'FFBFBFBF' } }, right: { style: 'thin', color: { argb: 'FFBFBFBF' } }
                        };
                    });
                }
            });
            if (worksheet.getRow(1)) worksheet.getRow(1).height = 30;

            const buffer = await workbook.xlsx.writeBuffer();
            const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Anadolu_Genclik_Renkli_${new Date().toISOString().slice(0, 10)}.xlsx`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            if (wasMultiDeleteActive) showRowCheckboxes();
        }


        function colorToARGB(color) {
            if (!color || color === 'transparent') return 'FFFFFFFF';

            let r = 255, g = 255, b = 255;

            if (color.startsWith('rgb')) {
                const match = color.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
                if (match) {
                    r = parseInt(match[1]);
                    g = parseInt(match[2]);
                    b = parseInt(match[3]);
                }
            } else if (color.startsWith('#')) {
                const hex = color.substring(1);
                if (hex.length === 3) {
                    r = parseInt(hex[0] + hex[0], 16);
                    g = parseInt(hex[1] + hex[1], 16);
                    b = parseInt(hex[2] + hex[2], 16);
                } else if (hex.length === 6) {
                    r = parseInt(hex.substring(0, 2), 16);
                    g = parseInt(hex.substring(2, 4), 16);
                    b = parseInt(hex.substring(4, 6), 16);
                }
            } else {
                const namedColorMap = { 'white': 'FFFFFFFF', 'black': 'FF000000' };
                if (namedColorMap[color.toLowerCase()]) return namedColorMap[color.toLowerCase()];
                console.warn("Bilinmeyen renk adı:", color, "Beyaz varsayılıyor.");
                return 'FFFFFFFF';
            }
            return `FF${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`.toUpperCase();
        }

        function exportToCSV() {
            const wasMultiDeleteActive = isMultiDeleteModeActive;
            if (wasMultiDeleteActive) hideRowCheckboxes();

            const table = document.getElementById('dynamicTable');
            let csv = '';

            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                if (th.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                headers.push(`"${th.textContent.trim().replace(/"/g, '""')}"`);
            });

            if (headers.length === 0) {
                alert("Dışa aktarılacak veri bulunamadı.");
                if (wasMultiDeleteActive) showRowCheckboxes();
                return;
            }
            csv += headers.join(',') + '\n';

            table.querySelectorAll('tbody tr').forEach(row => {
                const rowData = [];
                Array.from(row.cells).forEach(td => {
                    if (td.classList.contains(CHECKBOX_COLUMN_CLASS)) return;
                    const input = td.querySelector('.editable');
                    const text = input ? input.value.trim() : td.textContent.trim();
                    rowData.push(`"${text.replace(/"/g, '""')}"`);
                });
                if (rowData.length > 0) {
                    csv += rowData.join(',') + '\n';
                }
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Anadolu_Genclik_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            if (wasMultiDeleteActive) showRowCheckboxes();
        }

        function toggleMultiDeleteMode() {
            isMultiDeleteModeActive = !isMultiDeleteModeActive;
            const toggleBtn = document.getElementById('toggleMultiDeleteBtn');
            const confirmBtn = document.getElementById('confirmDeleteSelectedBtn');
            const singleDeleteRowBtn = document.getElementById('singleDeleteRowBtn');
            const addColumnBtn = document.getElementById('addColumnBtn');
            const deleteColumnBtn = document.getElementById('deleteColumnBtn');

            if (isMultiDeleteModeActive) {
                showRowCheckboxes();
                toggleBtn.textContent = '✖️ İptal';
                toggleBtn.classList.remove('btn-info');
                toggleBtn.classList.add('btn-danger');
                confirmBtn.style.display = 'inline-block';
                if (singleDeleteRowBtn) singleDeleteRowBtn.style.display = 'none';
                if (addColumnBtn) addColumnBtn.disabled = true;
                if (deleteColumnBtn) deleteColumnBtn.disabled = true;
                clearSelection(false);
                updateSelectionInfo('Çoklu satır silme modu aktif. Satırları seçip onaylayın.');
            } else {
                hideRowCheckboxes();
                toggleBtn.textContent = '🔪 Çoklu Silme';
                toggleBtn.classList.remove('btn-danger');
                toggleBtn.classList.add('btn-info');
                confirmBtn.style.display = 'none';
                if (singleDeleteRowBtn) singleDeleteRowBtn.style.display = 'inline-block';
                if (addColumnBtn) addColumnBtn.disabled = false;
                if (deleteColumnBtn) deleteColumnBtn.disabled = false;
                updateSelectionInfo(null);
            }
            updateColumnClickEvents();
        }

        function showRowCheckboxes() {
            const table = document.getElementById('dynamicTable');
            const theadTr = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');

            if (theadTr && !theadTr.querySelector(`th.${CHECKBOX_COLUMN_CLASS}`)) {
                const th = document.createElement('th');
                th.classList.add(CHECKBOX_COLUMN_CLASS);
                // th.innerHTML = '<input type="checkbox" onclick="toggleSelectAllRows(this)" title="Tümünü Seç/Kaldır">';
                th.style.width = '40px';
                th.style.background = '#34495e';
                th.style.textAlign = 'center';
                theadTr.insertBefore(th, theadTr.firstChild);
            }

            tbody.querySelectorAll('tr').forEach(row => {
                if (!row.querySelector(`td.${CHECKBOX_COLUMN_CLASS}`)) {
                    const cell = row.insertCell(0);
                    cell.classList.add(CHECKBOX_COLUMN_CLASS);
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.style.cursor = 'pointer';
                    checkbox.onclick = function (event) { event.stopPropagation(); };
                    cell.appendChild(checkbox);
                    cell.style.textAlign = 'center';
                    cell.style.verticalAlign = 'middle';
                    cell.onclick = function (event) { event.stopPropagation(); checkbox.click(); };
                }
            });
            updateStats();
        }

        function hideRowCheckboxes() {
            const table = document.getElementById('dynamicTable');
            table.querySelectorAll(`.${CHECKBOX_COLUMN_CLASS}`).forEach(cell => cell.remove());
            updateStats();
        }

        function confirmDeleteSelectedRows() {
            const tbody = document.getElementById('dynamicTable').querySelector('tbody');
            const rowsToDelete = [];
            tbody.querySelectorAll('tr').forEach(row => {
                const checkboxCell = row.cells[0];
                if (checkboxCell && checkboxCell.classList.contains(CHECKBOX_COLUMN_CLASS)) {
                    const checkbox = checkboxCell.querySelector('input[type="checkbox"]');
                    if (checkbox && checkbox.checked) {
                        rowsToDelete.push(row);
                    }
                }
            });

            if (rowsToDelete.length === 0) {
                alert('Lütfen silmek için en az bir satır seçin.');
                return;
            }

            if (confirm(`${rowsToDelete.length} satır silinecek. Emin misiniz?`)) {
                rowsToDelete.forEach(row => row.remove());

                isMultiDeleteModeActive = false;
                hideRowCheckboxes();

                const toggleBtn = document.getElementById('toggleMultiDeleteBtn');
                const confirmBtn = document.getElementById('confirmDeleteSelectedBtn');
                const singleDeleteRowBtn = document.getElementById('singleDeleteRowBtn');
                const addColumnBtn = document.getElementById('addColumnBtn');
                const deleteColumnBtn = document.getElementById('deleteColumnBtn');

                toggleBtn.textContent = '🔪 Çoklu Silme';
                toggleBtn.classList.remove('btn-danger');
                toggleBtn.classList.add('btn-info');
                confirmBtn.style.display = 'none';
                if (singleDeleteRowBtn) singleDeleteRowBtn.style.display = 'inline-block';
                if (addColumnBtn) addColumnBtn.disabled = false;
                if (deleteColumnBtn) deleteColumnBtn.disabled = false;

                updateStats();
                updateRowNumbers();
                updateSelectionInfo(null);
                updateColumnClickEvents();
            }
        }
        const originalOnload = window.onload;
        window.onload = function () {
            if (originalOnload) {
                originalOnload();
            }
            updateFixedElementLayout();
            updateStats();
            updateColumnClickEvents();
            updateRowNumbers();
            const addColumnBtn = document.getElementById('addColumnBtn');
            const deleteColumnBtn = document.getElementById('deleteColumnBtn');
            if (addColumnBtn) addColumnBtn.disabled = false;
            if (deleteColumnBtn) deleteColumnBtn.disabled = false;
        }
        window.addEventListener('resize', updateFixedElementLayout);
    </script>
</body>

</html>